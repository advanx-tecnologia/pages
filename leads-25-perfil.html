<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
    <title>Processo Seletivo IMP√âRIO - Advanx</title>
    
    <!-- Preconnect APENAS essencial -->
    <link rel="preconnect" href="https://n8n.advfunnel.com.br">
    
    <!-- Preload APENAS logo cr√≠tica -->
    <link rel="preload" as="image" href="https://lhbwfbquxkutcyqazpnw.supabase.co/storage/v1/object/public/images/logo/v3%20png.webp" fetchpriority="high">
    
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{
            --primary:#ff7a01;
            --bg-dark:#0a0a0a;
            --bg-card:#1a1a1a;
            --text:#fff;
            --text-secondary:#a0a0a0;
            --border:rgba(255,122,1,0.2)
        }
        body{
            font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
            background:var(--bg-dark);
            color:var(--text);
            min-height:100vh;
            overflow-x:hidden;
            -webkit-font-smoothing:antialiased;
            -webkit-tap-highlight-color:transparent
        }
        body::before{
            content:'';
            position:fixed;
            top:0;
            left:0;
            width:100%;
            height:100%;
            background:#0a0a0a;
            z-index:-2
        }
        body::after{
            content:'';
            position:fixed;
            top:0;
            left:0;
            width:100%;
            height:100%;
            background:linear-gradient(135deg,rgba(26,26,26,0.92),rgba(45,45,45,0.92));
            z-index:-1
        }
        /* Background apenas desktop */
        @media(min-width:769px){
            .bg-loaded body::before{
                background-image:url('https://advanx.com.br/wp-content/uploads/2025/10/back-2.webp');
                background-size:cover;
                background-position:center
            }
        }
        .container{
            max-width:680px;
            margin:0 auto;
            padding:10px 20px 20px
        }
        .logo-container{
            text-align:center;
            padding:12px 0 8px;
            cursor:pointer;
            user-select:none;
            -webkit-user-select:none
        }
        .logo-container img{
            max-width:120px;
            height:auto;
            transition:transform 0.2s;
            will-change:transform
        }
        .logo-container:active img{
            transform:scale(0.95)
        }
        .progress-container{
            margin:20px 0 25px;
            padding:0 10px
        }
        .progress-text{
            display:flex;
            justify-content:flex-end;
            margin-bottom:12px;
            font-size:14px;
            color:var(--text-secondary)
        }
        .progress-bar{
            width:100%;
            height:6px;
            background:rgba(255,255,255,0.05);
            border-radius:10px;
            overflow:hidden
        }
        .progress-fill{
            height:100%;
            background:linear-gradient(90deg,var(--primary),#ffaa00);
            border-radius:10px;
            transition:width 0.6s ease;
            will-change:width
        }
        .card{
            background:var(--bg-card);
            border-radius:24px;
            padding:50px 40px;
            border:1px solid var(--border)
        }
        /* Sombras apenas desktop */
        @media(min-width:769px){
            .card{
                box-shadow:0 20px 60px rgba(0,0,0,0.5)
            }
        }
        .question-title{
            font-size:28px;
            font-weight:700;
            line-height:1.4;
            margin-bottom:35px;
            color:var(--text)
        }
        .subtitle{
            font-size:17px;
            color:#e0e0e0;
            margin-bottom:20px;
            line-height:1.6
        }
        .input-group{
            margin-bottom:25px
        }
        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="password"],
        textarea{
            width:100%;
            padding:16px 20px;
            background:rgba(255,255,255,0.03);
            border:1px solid rgba(255,255,255,0.1);
            border-radius:12px;
            color:var(--text);
            font-size:16px;
            outline:none;
            transition:border-color 0.2s,background 0.2s
        }
        textarea{
            min-height:120px;
            resize:vertical;
            font-family:inherit
        }
        input:focus,
        textarea:focus{
            border-color:var(--primary);
            background:rgba(255,122,1,0.05)
        }
        .option-btn{
            width:100%;
            padding:18px 24px;
            margin-bottom:15px;
            background:rgba(255,255,255,0.03);
            border:1px solid rgba(255,255,255,0.1);
            border-radius:12px;
            color:var(--text);
            font-size:16px;
            font-weight:500;
            cursor:pointer;
            text-align:left;
            transition:all 0.2s ease;
            will-change:transform
        }
        .option-btn:active{
            transform:scale(0.98)
        }
        .option-btn.selected{
            background:rgba(255,122,1,0.15);
            border-color:var(--primary)
        }
        .option-btn.reject{
            background:rgba(220,38,38,0.1);
            border-color:#dc2626;
            color:#fca5a5
        }
        .btn-primary{
            width:100%;
            padding:18px 32px;
            background:linear-gradient(135deg,var(--primary),#ffaa00);
            border:none;
            border-radius:12px;
            color:#fff;
            font-size:17px;
            font-weight:700;
            cursor:pointer;
            transition:transform 0.2s ease;
            will-change:transform
        }
        /* Box-shadow apenas desktop */
        @media(min-width:769px){
            .btn-primary{
                box-shadow:0 10px 30px rgba(255,122,1,0.3)
            }
        }
        .btn-primary:active{
            transform:scale(0.98)
        }
        .btn-primary:disabled{
            opacity:0.5;
            cursor:not-allowed
        }
        .nav-buttons{
            display:flex;
            gap:15px;
            margin-top:30px
        }
        .btn-back{
            flex:1;
            max-width:120px;
            padding:12px 16px;
            background:transparent;
            border:1px solid rgba(255,255,255,0.15);
            color:rgba(255,255,255,0.5);
            font-size:14px;
            border-radius:12px;
            cursor:pointer
        }
        .btn-next{
            flex:1;
            padding:16px;
            background:linear-gradient(135deg,var(--primary),#ffaa00);
            border:none;
            color:#fff;
            font-size:16px;
            font-weight:600;
            border-radius:12px;
            cursor:pointer
        }
        /* Box-shadow apenas desktop */
        @media(min-width:769px){
            .btn-next{
                box-shadow:0 8px 20px rgba(255,122,1,0.3)
            }
        }
        .hidden{
            display:none!important
        }
        .error-message{
            color:#ff4444;
            font-size:14px;
            margin-top:8px;
            display:none
        }
        .error-message.show{
            display:block
        }
        .phone-hint{
            display:none;
            margin-top:12px;
            padding:14px 16px;
            background:rgba(16,185,129,0.15);
            border-left:3px solid #10b981;
            border-radius:8px;
            font-size:15px;
            color:#10b981;
            font-weight:500
        }
        .phone-hint.show{
            display:block
        }
        .phone-hint strong{
            color:#fff;
            font-size:16px
        }
        .loading-overlay{
            display:none;
            position:fixed;
            top:0;
            left:0;
            width:100%;
            height:100%;
            background:rgba(0,0,0,0.85);
            z-index:2000;
            align-items:center;
            justify-content:center;
            flex-direction:column;
            gap:20px
        }
        .loading-overlay.show{
            display:flex
        }
        .spinner{
            border:4px solid rgba(255,255,255,0.1);
            border-top:4px solid var(--primary);
            border-radius:50%;
            width:50px;
            height:50px;
            animation:spin 1s linear infinite;
            transform:translateZ(0)
        }
        .loading-text{
            color:var(--text);
            font-size:16px;
            font-weight:500
        }
        .admin-modal{
            display:none;
            position:fixed;
            top:0;
            left:0;
            width:100%;
            height:100%;
            background:rgba(0,0,0,0.9);
            z-index:3000;
            align-items:center;
            justify-content:center;
            padding:20px
        }
        .admin-modal.show{
            display:flex
        }
        .admin-content{
            background:var(--bg-card);
            border-radius:20px;
            padding:40px;
            max-width:600px;
            width:100%;
            max-height:90vh;
            overflow-y:auto;
            border:1px solid var(--border)
        }
        .admin-header{
            display:flex;
            justify-content:space-between;
            align-items:center;
            margin-bottom:30px
        }
        .admin-title{
            font-size:24px;
            font-weight:700;
            color:var(--primary)
        }
        .admin-close{
            background:transparent;
            border:none;
            color:var(--text-secondary);
            font-size:28px;
            cursor:pointer;
            padding:0;
            width:32px;
            height:32px;
            display:flex;
            align-items:center;
            justify-content:center
        }
        .admin-section{
            margin-bottom:30px
        }
        .admin-section-title{
            font-size:16px;
            font-weight:600;
            color:var(--primary);
            margin-bottom:15px;
            text-transform:uppercase;
            letter-spacing:0.5px
        }
        .admin-field{
            margin-bottom:15px
        }
        .admin-label{
            display:block;
            font-size:14px;
            color:var(--text-secondary);
            margin-bottom:8px
        }
        .admin-save{
            width:100%;
            padding:16px;
            background:linear-gradient(135deg,#10b981,#059669);
            border:none;
            border-radius:12px;
            color:#fff;
            font-size:16px;
            font-weight:600;
            cursor:pointer;
            margin-top:10px
        }
        .admin-save:active{
            transform:scale(0.98)
        }
        .success-message{
            background:rgba(16,185,129,0.15);
            border-left:3px solid #10b981;
            padding:12px 16px;
            border-radius:8px;
            color:#10b981;
            margin-top:15px;
            display:none
        }
        .success-message.show{
            display:block
        }
        @keyframes spin{
            to{transform:rotate(360deg)}
        }
        @media(max-width:768px){
            .container{
                padding:8px 15px 15px
            }
            .card{
                padding:35px 25px;
                border-radius:20px
            }
            .question-title{
                font-size:24px;
                margin-bottom:25px
            }
            .option-btn,
            .btn-primary{
                padding:16px 20px;
                font-size:15px
            }
            .logo-container img{
                max-width:100px
            }
            .admin-content{
                padding:30px 20px
            }
        }
        @media(max-width:480px){
            .question-title{
                font-size:20px
            }
            .subtitle{
                font-size:15px
            }
            .card{
                padding:30px 20px;
                border-radius:16px
            }
            .logo-container img{
                max-width:90px
            }
            .progress-container{
                margin:15px 0 20px
            }
            .progress-bar{
                height:4px
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo-container" id="logoTrigger">
            <img src="https://lhbwfbquxkutcyqazpnw.supabase.co/storage/v1/object/public/images/logo/v3%20png.webp" alt="Advanx Logo" loading="eager" width="120" height="40">
        </div>

        <div class="progress-container">
            <div class="progress-text">
                <span id="progressPercent">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width:0%"></div>
            </div>
        </div>

        <div class="card">
            <!-- STEP 0: Apresenta√ß√£o -->
            <div class="step" id="step0">
                <h1 class="question-title">Nossa proposta √© criar um ecossistema de gera√ß√£o de demanda qualificada paga e organica, vendas com crescimento estruturado e controlado, economizando at√© 70% de custos fixos em alguns casos usando tecnologia automa√ß√µes e IA.</h1>
                <p class="subtitle">Sem cursos, Mentorias ou depend√™ncia de ag√™ncias.</p>
                <p class="subtitle" style="color:#ffaa00;font-weight:600">Mas n√£o √© pra qualquer um, essa aplica√ß√£o √© um processo seletivo.</p>
                <p class="subtitle">S√≥ entra quem j√° fatura e entendeu que adiar cria√ß√£o de estrutura de neg√≥cio √© a rota mais r√°pida para o fracasso.</p>
                <p class="subtitle" style="margin-top:25px;color:#c5c5c5;font-size:16px">Preencha o formul√°rio que meu time vai analisar seu perfil e decidir se voc√™ est√° no momento para entrar no IMP√âRIO.</p>
                <button class="btn-primary" onclick="startForm()">Come√ßar Processo Seletivo ‚Üí</button>
            </div>

            <!-- STEP 1: Qualifica√ß√£o -->
            <div class="step hidden" id="step1">
                <h2 class="question-title">Voc√™ leu o texto na p√°gina anterior e est√° preparado(a) para fazer uma reuni√£o de an√°lise comigo nas pr√≥ximas 48 horas?</h2>
                <button class="option-btn" onclick="selectQualification(this,'qualificacao','Sim, vamos continuar')">‚úÖ Sim, vamos continuar</button>
                <button class="option-btn reject" onclick="handleRejection()">‚ùå N√£o √© pra mim</button>
                <div class="error-message" id="error1">Por favor, selecione uma op√ß√£o.</div>
                <button class="btn-back" onclick="prevStep()" style="margin-top:15px;width:auto;padding:12px 20px;font-size:14px;opacity:0.6">‚Üê Voltar</button>
            </div>

            <!-- STEP 2: Nome -->
            <div class="step hidden" id="step2">
                <h2 class="question-title">Digite seu Nome Completo:</h2>
                <div class="input-group">
                    <input type="text" id="nome" placeholder="Ex: Jo√£o Silva" autocomplete="name">
                    <div class="error-message" id="error2">Por favor, digite seu nome completo.</div>
                </div>
                <div class="nav-buttons">
                    <button class="btn-back" onclick="prevStep()">‚Üê Voltar</button>
                    <button class="btn-next" onclick="nextStep()">Continuar ‚Üí</button>
                </div>
            </div>

            <!-- STEP 3: Telefone -->
            <div class="step hidden" id="step3">
                <h2 class="question-title">Qual seu n√∫mero de celular/WhatsApp?</h2>
                <p class="subtitle" style="margin-bottom:20px;font-size:15px">Obs.: N√£o coloque o telefone comercial.</p>
                <div class="input-group">
                    <input type="tel" id="whatsapp" placeholder="(11) 9 9289-9988" maxlength="17" autocomplete="tel" inputmode="numeric">
                    <div class="phone-hint" id="phoneHint">
                        ‚úì Por favor, confirme se o n√∫mero est√° correto: <strong id="phoneDisplay"></strong>
                    </div>
                    <div class="error-message" id="error3">Por favor, digite um n√∫mero v√°lido com DDD + 9 d√≠gitos.</div>
                </div>
                <div class="nav-buttons">
                    <button class="btn-back" onclick="prevStep()">‚Üê Voltar</button>
                    <button class="btn-next" onclick="nextStep()">Continuar ‚Üí</button>
                </div>
            </div>

            <!-- STEP 4: Email -->
            <div class="step hidden" id="step4">
                <h2 class="question-title">Digite seu melhor e-mail:</h2>
                <div class="input-group">
                    <input type="email" id="email" placeholder="seuemail@exemplo.com" autocomplete="email" inputmode="email">
                    <div class="error-message" id="error4">Por favor, digite um e-mail v√°lido.</div>
                </div>
                <div class="nav-buttons">
                    <button class="btn-back" onclick="prevStep()">‚Üê Voltar</button>
                    <button class="btn-next" onclick="nextStep()">Continuar ‚Üí</button>
                </div>
            </div>

            <!-- STEP 5: Instagram ou Site -->
            <div class="step hidden" id="step5">
                <h2 class="question-title">Qual o Instagram ou site</h2>
                <div class="input-group">
                    <input type="text" id="instagram_site" placeholder="Ex: @seuescritorio ou www.seusite.com.br">
                    <div class="error-message" id="error5">Por favor, digite seu Instagram ou site.</div>
                </div>
                <div class="nav-buttons">
                    <button class="btn-back" onclick="prevStep()">‚Üê Voltar</button>
                    <button class="btn-next" onclick="nextStep()">Continuar ‚Üí</button>
                </div>
            </div>

            <!-- STEP 6: Estrutura Atual -->
            <div class="step hidden" id="step6">
                <h2 class="question-title">Descreva em poucas palavras sua estrutura atual.</h2>
                <p class="subtitle" style="margin-bottom:20px;font-size:15px">Exemplo: tenho um escrit√≥rio com 10 anos de mercado, especializado na area x, 47 clientes e 14 funcion√°rios</p>
                <div class="input-group">
                    <textarea id="estrutura_atual" placeholder="Descreva aqui sua estrutura..."></textarea>
                    <div class="error-message" id="error6">Por favor, descreva sua estrutura atual (m√≠nimo 10 caracteres).</div>
                </div>
                <div class="nav-buttons">
                    <button class="btn-back" onclick="prevStep()">‚Üê Voltar</button>
                    <button class="btn-next" onclick="nextStep()">Continuar ‚Üí</button>
                </div>
            </div>

            <!-- STEP 7: Faturamento -->
            <div class="step hidden" id="step7">
                <h2 class="question-title">Qual a m√©dia de faturamento mensal?</h2>
                <button class="option-btn" onclick="selectFaturamento(this,'faturamento','0 a 5 mil reais')">0 a 5 mil reais</button>
                <button class="option-btn" onclick="selectFaturamento(this,'faturamento','5 a 10 mil reais')">5 a 10 mil reais</button>
                <button class="option-btn" onclick="selectFaturamento(this,'faturamento','10 a 20 mil reais')">10 a 20 mil reais</button>
                <button class="option-btn" onclick="selectFaturamento(this,'faturamento','20 a 50 mil reais')">20 a 50 mil reais</button>
                <button class="option-btn" onclick="selectFaturamento(this,'faturamento','50 a 100 mil reais')">50 a 100 mil reais</button>
                <button class="option-btn" onclick="selectFaturamento(this,'faturamento','Mais de 100 mil reais')">Mais de 100 mil reais</button>
                <div class="error-message" id="error7">Por favor, selecione uma op√ß√£o.</div>
                <button class="btn-back" onclick="prevStep()" style="margin-top:15px;width:auto;padding:12px 20px;font-size:14px;opacity:0.6">‚Üê Voltar</button>
            </div>
        </div>
    </div>

    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <div class="loading-text">Enviando suas informa√ß√µes...</div>
    </div>

    <!-- Admin Panel Modal -->
    <div class="admin-modal" id="adminModal">
        <div class="admin-content">
            <div class="admin-header">
                <h2 class="admin-title">üîß Painel Administrativo</h2>
                <button class="admin-close" onclick="closeAdminPanel()">√ó</button>
            </div>

            <div class="admin-section">
                <h3 class="admin-section-title">üîó URLs e Webhook</h3>
                <div class="admin-field">
                    <label class="admin-label">Webhook URL (n8n)</label>
                    <input type="text" id="adminWebhook" placeholder="https://n8n.advfunnel.com.br/webhook/...">
                </div>
                <div class="admin-field">
                    <label class="admin-label">URL de Redirecionamento</label>
                    <input type="text" id="adminRedirect" placeholder="https://advanx.com.br/agenda/">
                </div>
            </div>

            <div class="admin-section">
                <h3 class="admin-section-title">üìä IDs de Tracking</h3>
                <div class="admin-field">
                    <label class="admin-label">Google Tag Manager ID</label>
                    <input type="text" id="adminGTM" placeholder="GTM-XXXXXX">
                </div>
                <div class="admin-field">
                    <label class="admin-label">Facebook Pixel ID</label>
                    <input type="text" id="adminFBPixel" placeholder="502759528362336">
                </div>
                <div class="admin-field">
                    <label class="admin-label">Google Analytics ID</label>
                    <input type="text" id="adminGA" placeholder="G-98EL5GXG5F">
                </div>
            </div>

            <button class="admin-save" onclick="saveAdminSettings()">üíæ Salvar Configura√ß√µes</button>
            <div class="success-message" id="adminSuccess">‚úì Configura√ß√µes salvas com sucesso!</div>
        </div>
    </div>

    <script>
        // Configura√ß√µes padr√£o
        let config = {
            webhook: 'https://n8n.advfunnel.com.br/webhook/processo-comercial-inteligente',
            redirectUrl: 'https://advanx.com.br/agenda/',
            gtmId: 'GTM-XXXXXX',
            fbPixelId: '502759528362336',
            gaId: 'G-98EL5GXG5F',
            adminPassword: '2112'
        };

        // Vari√°veis globais
        let currentStep = 0;
        const totalSteps = 8;
        let formData = {};
        let webhookSent = false;

        // Debounce helper
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Carregar configura√ß√µes do localStorage
        function loadConfig() {
            const saved = localStorage.getItem('advanx_admin_config');
            if (saved) {
                config = { ...config, ...JSON.parse(saved) };
            }
        }

        // Admin Panel - Click Counter
        let logoClickCount = 0;
        let logoClickTimer = null;

        document.getElementById('logoTrigger').addEventListener('click', function() {
            logoClickCount++;
            
            if (logoClickTimer) {
                clearTimeout(logoClickTimer);
            }
            
            if (logoClickCount >= 3) {
                logoClickCount = 0;
                openAdminPanel();
            } else {
                logoClickTimer = setTimeout(() => {
                    logoClickCount = 0;
                }, 1000);
            }
        });

        function openAdminPanel() {
            const password = prompt('üîê Digite a senha de administrador:');
            
            if (password === config.adminPassword) {
                document.getElementById('adminWebhook').value = config.webhook;
                document.getElementById('adminRedirect').value = config.redirectUrl;
                document.getElementById('adminGTM').value = config.gtmId;
                document.getElementById('adminFBPixel').value = config.fbPixelId;
                document.getElementById('adminGA').value = config.gaId;
                
                document.getElementById('adminModal').classList.add('show');
            } else if (password !== null) {
                alert('‚ùå Senha incorreta!');
            }
        }

        function closeAdminPanel() {
            document.getElementById('adminModal').classList.remove('show');
            document.getElementById('adminSuccess').classList.remove('show');
        }

        function saveAdminSettings() {
            config.webhook = document.getElementById('adminWebhook').value;
            config.redirectUrl = document.getElementById('adminRedirect').value;
            config.gtmId = document.getElementById('adminGTM').value;
            config.fbPixelId = document.getElementById('adminFBPixel').value;
            config.gaId = document.getElementById('adminGA').value;
            
            localStorage.setItem('advanx_admin_config', JSON.stringify(config));
            
            const successMsg = document.getElementById('adminSuccess');
            successMsg.classList.add('show');
            
            setTimeout(() => {
                successMsg.classList.remove('show');
                closeAdminPanel();
                alert('‚úÖ Configura√ß√µes salvas! Recarregue a p√°gina para aplicar os pixels.');
            }, 2000);
        }

        // Captura de UTMs
        function captureUTMs() {
            const params = new URLSearchParams(window.location.search);
            const utmData = {
                utm_source: params.get('utm_source') || '',
                utm_medium: params.get('utm_medium') || '',
                utm_campaign: params.get('utm_campaign') || '',
                utm_term: params.get('utm_term') || '',
                utm_content: params.get('utm_content') || '',
                gclid: params.get('gclid') || '',
                fbclid: params.get('fbclid') || '',
                msclkid: params.get('msclkid') || '',
                url_completa: window.location.href,
                referrer: document.referrer || '',
                timestamp: new Date().toISOString()
            };
            
            Object.keys(utmData).forEach(key => {
                if (utmData[key]) {
                    formData[key] = utmData[key];
                }
            });
        }

        // Tracking de eventos
        function trackEvent(eventName, data = {}) {
            const eventData = {
                ...formData,
                ...data,
                step: currentStep,
                event_name: eventName
            };
            
            if (typeof fbq !== 'undefined') {
                fbq('track', eventName, eventData);
            }
            
            if (typeof gtag !== 'undefined') {
                gtag('event', eventName, eventData);
            }
            
            if (typeof window.dataLayer !== 'undefined') {
                window.dataLayer.push({
                    event: eventName,
                    ...eventData
                });
            }
        }

        function startForm() {
            trackEvent('FormStarted');
            nextStep();
        }

        function updateProgress() {
            const percent = Math.round((currentStep / totalSteps) * 100);
            document.getElementById('progressPercent').textContent = `${percent}%`;
            document.getElementById('progressFill').style.width = `${percent}%`;
        }

        function showStep(step) {
            document.querySelectorAll('.step').forEach(s => s.classList.add('hidden'));
            document.getElementById(`step${step}`).classList.remove('hidden');
            updateProgress();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function nextStep() {
            if (!validateStep(currentStep)) return;
            
            const eventNames = [
                'FormStarted',
                'QualificationAccepted',
                'NameEntered',
                'PhoneEntered',
                'EmailEntered',
                'InstagramEntered',
                'StructureDescribed',
                'RevenueSelected'
            ];
            
            if (currentStep > 0 && currentStep < eventNames.length) {
                trackEvent(eventNames[currentStep]);
            }
            
            currentStep++;
            showStep(currentStep);
        }

        function prevStep() {
            if (currentStep > 0) {
                currentStep--;
                showStep(currentStep);
            }
        }

        function validateStep(step) {
            const errorElement = document.getElementById(`error${step}`);
            if (errorElement) {
                errorElement.classList.remove('show');
            }
            
            if (step === 0) {
                return true;
            } else if (step === 1) {
                if (!formData.qualificacao) {
                    document.getElementById('error1').classList.add('show');
                    return false;
                }
            } else if (step === 2) {
                const nome = document.getElementById('nome').value.trim();
                if (nome.length < 3) {
                    document.getElementById('error2').classList.add('show');
                    return false;
                }
                formData.nome = nome;
            } else if (step === 3) {
                const whatsapp = document.getElementById('whatsapp').value.trim();
                const numbers = whatsapp.replace(/\D/g, '');
                if (numbers.length !== 11) {
                    document.getElementById('error3').classList.add('show');
                    return false;
                }
                formData.whatsapp = '+55' + numbers;
            } else if (step === 4) {
                const email = document.getElementById('email').value.trim();
                if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                    document.getElementById('error4').classList.add('show');
                    return false;
                }
                formData.email = email;
            } else if (step === 5) {
                const instagram = document.getElementById('instagram_site').value.trim();
                if (instagram.length < 3) {
                    document.getElementById('error5').classList.add('show');
                    return false;
                }
                formData.instagram_site = instagram;
            } else if (step === 6) {
                const estrutura = document.getElementById('estrutura_atual').value.trim();
                if (estrutura.length < 10) {
                    document.getElementById('error6').classList.add('show');
                    return false;
                }
                formData.estrutura_atual = estrutura;
            } else if (step === 7) {
                if (!formData.faturamento) {
                    document.getElementById('error7').classList.add('show');
                    return false;
                }
            }
            
            return true;
        }

        function selectQualification(btn, key, value) {
            const parent = btn.parentElement;
            parent.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            formData[key] = value;
            setTimeout(() => nextStep(), 300);
        }

        function handleRejection() {
            trackEvent('FormRejected', { reason: 'not_ready' });
            alert('Obrigado pelo seu tempo. Quando estiver pronto, volte e preencha o formul√°rio!');
            window.location.href = 'https://advanx.com.br';
        }

        function selectFaturamento(btn, key, value) {
            const parent = btn.parentElement;
            parent.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            formData[key] = value;
            trackEvent('Lead');
            setTimeout(() => submitAndRedirect(), 400);
        }

        // Webhook com timeout
        async function sendToWebhook() {
            if (webhookSent) return true;
            
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 8000); // 8s timeout
            
            try {
                const response = await fetch(config.webhook, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData),
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                webhookSent = true;
                trackEvent('WebhookSuccess');
                return true;
            } catch (error) {
                clearTimeout(timeoutId);
                console.error('Webhook error:', error);
                trackEvent('WebhookError', { error: error.message });
                // Mesmo com erro, redireciona
                return true;
            }
        }

        async function submitAndRedirect() {
            document.getElementById('loadingOverlay').classList.add('show');
            await sendToWebhook();
            setTimeout(() => {
                window.location.href = config.redirectUrl;
            }, 500);
        }

        // M√°scara de telefone com debounce otimizado
        const formatPhone = debounce(function(e) {
            let value = e.target.value.replace(/\D/g, '');
            
            if (value.length > 11) {
                value = value.slice(0, 11);
            }
            
            if (value.length >= 11) {
                value = value.replace(/^(\d{2})(\d{1})(\d{4})(\d{4})$/, '($1) $2 $3-$4');
            } else if (value.length >= 7) {
                value = value.replace(/^(\d{2})(\d{1})(\d{4})(\d{0,4})/, '($1) $2 $3-$4');
            } else if (value.length >= 3) {
                value = value.replace(/^(\d{2})(\d{1})(\d{0,4})/, '($1) $2 $3');
            } else if (value.length >= 2) {
                value = value.replace(/^(\d{2})/, '($1) ');
            }
            
            e.target.value = value;
            
            const numbers = value.replace(/\D/g, '');
            const phoneHint = document.getElementById('phoneHint');
            const phoneDisplay = document.getElementById('phoneDisplay');
            
            if (numbers.length === 11) {
                phoneHint.classList.add('show');
                phoneDisplay.textContent = value;
            } else {
                phoneHint.classList.remove('show');
            }
        }, 150);

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            loadConfig();
            
            // M√°scara de telefone otimizada
            const whatsappInput = document.getElementById('whatsapp');
            if (whatsappInput) {
                whatsappInput.addEventListener('input', formatPhone);
            }
            
            // Carrega background apenas desktop
            if (window.innerWidth > 768) {
                const bgImage = new Image();
                bgImage.onload = () => document.body.classList.add('bg-loaded');
                bgImage.src = 'https://advanx.com.br/wp-content/uploads/2025/10/back-2.webp';
            }
            
            captureUTMs();
        });

        updateProgress();
    </script>

    <!-- GTM/Pixels carregados de forma async -->
    <script>
        // Carrega tracking de forma async ap√≥s p√°gina carregar
        if ('requestIdleCallback' in window) {
            requestIdleCallback(loadTracking);
        } else {
            setTimeout(loadTracking, 1000);
        }

        function loadTracking() {
            loadConfig();
            
            // Facebook Pixel
            if (config.fbPixelId && config.fbPixelId !== '502759528362336') {
                !function(f,b,e,v,n,t,s)
                {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
                n.callMethod.apply(n,arguments):n.queue.push(arguments)};
                if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
                n.queue=[];t=b.createElement(e);t.async=!0;
                t.src=v;s=b.getElementsByTagName(e)[0];
                s.parentNode.insertBefore(t,s)}(window, document,'script',
                'https://connect.facebook.net/en_US/fbevents.js');
                fbq('init', config.fbPixelId);
                fbq('track', 'PageView');
            }

            // Google Analytics
            if (config.gaId && config.gaId !== 'G-98EL5GXG5F') {
                const gaScript = document.createElement('script');
                gaScript.async = true;
                gaScript.src = 'https://www.googletagmanager.com/gtag/js?id=' + config.gaId;
                document.head.appendChild(gaScript);
                
                window.dataLayer = window.dataLayer || [];
                function gtag(){dataLayer.push(arguments);}
                gtag('js', new Date());
                gtag('config', config.gaId);
            }

            // GTM
            if (config.gtmId && config.gtmId !== 'GTM-XXXXXX') {
                (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                })(window,document,'script','dataLayer',config.gtmId);
            }
        }
    </script>
</body>
</html>
