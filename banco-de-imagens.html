<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciador de M√≠dia - DEBUG</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0a0a0a;
            color: #e0e0e0;
            padding: 20px;
        }

        /* DEBUG BOX */
        #debugBox {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #1a1a1a;
            border: 2px solid #10b981;
            border-radius: 8px;
            padding: 15px;
            max-width: 400px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 99999;
            font-family: monospace;
            font-size: 12px;
        }

        .debug-log {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #10b981;
            background: #0a0a0a;
        }

        .debug-error {
            border-left-color: #dc2626;
            color: #dc2626;
        }

        .debug-success {
            border-left-color: #10b981;
            color: #10b981;
        }

        #loginScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0a0a0a;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        #loginScreen.hidden {
            display: none;
        }

        .login-box {
            background: #1a1a1a;
            border: 2px solid #10b981;
            border-radius: 16px;
            padding: 40px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 8px 32px rgba(16, 185, 129, 0.2);
            text-align: center;
        }

        .login-box h1 {
            color: #10b981;
            margin-bottom: 10px;
            font-size: 2em;
            border: none;
            padding: 0;
        }

        .login-input {
            width: 100%;
            padding: 15px;
            background: #0a0a0a;
            border: 2px solid #3a3a3a;
            border-radius: 8px;
            color: #e0e0e0;
            font-size: 16px;
            text-align: center;
            margin: 20px 0;
        }

        .login-btn {
            width: 100%;
            padding: 15px;
            background: #10b981;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }

        #mainContent {
            display: none;
        }

        #mainContent.show {
            display: block;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            color: #fff;
            margin-bottom: 30px;
            font-size: 2em;
            border-bottom: 3px solid #10b981;
            padding-bottom: 15px;
        }

        .section {
            background: #1a1a1a;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid #2a2a2a;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #2a2a2a;
        }

        .tab {
            padding: 12px 24px;
            background: transparent;
            color: #b0b0b0;
            cursor: pointer;
            border: none;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            color: #10b981;
            border-bottom-color: #10b981;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .file-upload-area {
            border: 2px dashed #3a3a3a;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            background: #0a0a0a;
        }

        .file-upload-area:hover {
            border-color: #10b981;
        }

        .alert {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            border-left: 4px solid;
        }

        .alert-success {
            background: rgba(16, 185, 129, 0.1);
            border-color: #10b981;
            color: #10b981;
        }

        .alert-error {
            background: rgba(220, 38, 38, 0.1);
            border-color: #dc2626;
            color: #dc2626;
        }

        button {
            background: #10b981;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
        }

        button:hover {
            background: #059669;
        }

        button:disabled {
            background: #4a4a4a;
            cursor: not-allowed;
        }

        .video-preview {
            width: 100%;
            max-height: 400px;
            border-radius: 8px;
            background: #000;
            margin-top: 20px;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            background: #0a0a0a;
            border: 1px solid #3a3a3a;
            border-radius: 6px;
            color: #e0e0e0;
            font-size: 14px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <!-- DEBUG BOX -->
    <div id="debugBox">
        <div style="color: #10b981; font-weight: bold; margin-bottom: 10px;">üêõ DEBUG LOG</div>
        <div id="debugLogs"></div>
    </div>

    <!-- Login -->
    <div id="loginScreen">
        <div class="login-box">
            <h1>üîí Acesso</h1>
            <input 
                type="password" 
                id="passwordInput" 
                class="login-input" 
                placeholder="Senha: 2112"
            >
            <button class="login-btn" id="loginBtn">Entrar</button>
        </div>
    </div>

    <!-- Conte√∫do -->
    <div id="mainContent">
        <div class="container">
            <h1>üé¨ Gerenciador - MODO DEBUG</h1>

            <div id="alertContainer"></div>

            <div class="section">
                <h2>Upload de V√≠deo (Debug)</h2>
                
                <div class="tabs">
                    <button class="tab active" data-tab="video">üé• Teste Upload</button>
                </div>

                <div id="videoTab" class="tab-content active">
                    <div class="file-upload-area" id="videoDropZone">
                        <input type="file" id="videoInput" accept="video/*" style="display: none;">
                        <p style="font-size: 48px;">üé•</p>
                        <p style="color: #e0e0e0;">Clique ou arraste um v√≠deo</p>
                        <p style="font-size: 12px; color: #b0b0b0;">MP4, WebM, MOV</p>
                    </div>

                    <div id="videoUploadOptions" style="display: none; margin-top: 20px;">
                        <video id="videoPreview" class="video-preview" controls></video>
                        
                        <div style="margin-top: 20px;">
                            <p>Nome: <span id="videoFileName"></span></p>
                            <p>Tamanho: <span id="videoFileSize"></span></p>
                            <p>Tipo: <span id="videoFileType"></span></p>
                        </div>

                        <input type="text" id="videoNome" placeholder="Nome do v√≠deo">

                        <div style="margin-top: 20px;">
                            <button id="videoUploadBtn">Fazer Upload</button>
                            <button id="cancelVideoBtn" style="background: #dc2626; margin-left: 10px;">Cancelar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // SISTEMA DE DEBUG
        // ============================================

        function addDebugLog(message, type = 'info') {
            const debugLogs = document.getElementById('debugLogs');
            const log = document.createElement('div');
            log.className = `debug-log ${type === 'error' ? 'debug-error' : type === 'success' ? 'debug-success' : ''}`;
            log.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            debugLogs.appendChild(log);
            debugLogs.scrollTop = debugLogs.scrollHeight;
            console.log(`[DEBUG] ${message}`);
        }

        // ============================================
        // CONFIGURA√á√ïES
        // ============================================

        const SUPABASE_URL = 'https://lhbwfbquxkutcyqazpnw.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxoYndmYnF1eGt1dGN5cWF6cG53Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA1Mjc5MTksImV4cCI6MjA2NjEwMzkxOX0.Tk6O2kpzTWcce9laIancu-lMFATLYkaTvgLBiRMsa10';
        const CORRECT_PASSWORD = '2112';

        let selectedVideo = null;

        addDebugLog('Script carregado', 'success');

        // ============================================
        // LOGIN
        // ============================================

        function checkPassword() {
            const password = document.getElementById('passwordInput').value;
            addDebugLog(`Tentando login com senha: ${password}`);
            
            if (password === CORRECT_PASSWORD) {
                addDebugLog('Login aceito!', 'success');
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('mainContent').classList.add('show');
                sessionStorage.setItem('authenticated', 'true');
            } else {
                addDebugLog('Senha incorreta!', 'error');
                alert('Senha incorreta!');
            }
        }

        // ============================================
        // UPLOAD DE V√çDEO
        // ============================================

        function handleVideoFile(file) {
            addDebugLog(`handleVideoFile chamada! Arquivo: ${file.name}`, 'success');
            
            // Valida√ß√£o
            const maxSize = 100 * 1024 * 1024; // 100MB
            addDebugLog(`Tamanho do arquivo: ${(file.size / 1024 / 1024).toFixed(2)}MB`);
            
            if (file.size > maxSize) {
                addDebugLog('Arquivo muito grande!', 'error');
                alert('V√≠deo muito grande! Max 100MB');
                return;
            }

            addDebugLog(`Tipo do arquivo: ${file.type}`);
            const validTypes = ['video/mp4', 'video/webm', 'video/quicktime'];
            if (!validTypes.includes(file.type)) {
                addDebugLog('Tipo n√£o suportado!', 'error');
                alert('Formato n√£o suportado!');
                return;
            }

            selectedVideo = file;
            addDebugLog('V√≠deo aceito! Mostrando preview...', 'success');
            
            // Esconder dropzone
            document.getElementById('videoDropZone').style.display = 'none';
            document.getElementById('videoUploadOptions').style.display = 'block';

            // Preview
            const videoPreview = document.getElementById('videoPreview');
            const videoUrl = URL.createObjectURL(file);
            videoPreview.src = videoUrl;
            addDebugLog('Preview carregado', 'success');

            // Info
            document.getElementById('videoFileName').textContent = file.name;
            document.getElementById('videoFileSize').textContent = (file.size / 1024 / 1024).toFixed(2) + ' MB';
            document.getElementById('videoFileType').textContent = file.type;

            // Sugere nome
            const fileName = file.name.split('.')[0];
            document.getElementById('videoNome').value = fileName;
        }

        async function uploadVideo() {
            addDebugLog('Iniciando upload...', 'success');
            
            if (!selectedVideo) {
                addDebugLog('Nenhum v√≠deo selecionado!', 'error');
                alert('Nenhum v√≠deo selecionado!');
                return;
            }

            const nome = document.getElementById('videoNome').value;
            if (!nome) {
                addDebugLog('Nome vazio!', 'error');
                alert('Digite um nome!');
                return;
            }

            const uploadBtn = document.getElementById('videoUploadBtn');
            uploadBtn.disabled = true;
            uploadBtn.textContent = 'Fazendo upload...';

            try {
                addDebugLog(`Nome do v√≠deo: ${nome}`);
                const fileName = `videos/${nome}.${selectedVideo.name.split('.').pop()}`;
                addDebugLog(`Path completo: ${fileName}`);

                const uploadUrl = `${SUPABASE_URL}/storage/v1/object/images/${fileName}`;
                addDebugLog(`URL de upload: ${uploadUrl}`);

                addDebugLog('Enviando para Supabase...');
                const uploadResponse = await fetch(uploadUrl, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'Content-Type': selectedVideo.type
                    },
                    body: selectedVideo
                });

                addDebugLog(`Status da resposta: ${uploadResponse.status}`);

                if (!uploadResponse.ok) {
                    const error = await uploadResponse.json();
                    addDebugLog(`Erro: ${JSON.stringify(error)}`, 'error');
                    throw new Error(error.message || 'Erro no upload');
                }

                const publicUrl = `${SUPABASE_URL}/storage/v1/object/public/images/${fileName}`;
                addDebugLog(`Upload conclu√≠do! URL: ${publicUrl}`, 'success');

                alert('‚úÖ V√≠deo enviado com sucesso!\n\n' + publicUrl);

                uploadBtn.textContent = '‚úì Conclu√≠do';

            } catch (error) {
                addDebugLog(`ERRO: ${error.message}`, 'error');
                alert('‚ùå Erro: ' + error.message);
                uploadBtn.disabled = false;
                uploadBtn.textContent = 'Fazer Upload';
            }
        }

        function cancelVideoUpload() {
            addDebugLog('Upload cancelado');
            selectedVideo = null;
            document.getElementById('videoDropZone').style.display = 'block';
            document.getElementById('videoUploadOptions').style.display = 'none';
            document.getElementById('videoInput').value = '';
            document.getElementById('videoNome').value = '';
            document.getElementById('videoUploadBtn').textContent = 'Fazer Upload';
            document.getElementById('videoUploadBtn').disabled = false;
        }

        // ============================================
        // INICIALIZA√á√ÉO
        // ============================================

        window.addEventListener('DOMContentLoaded', () => {
            addDebugLog('DOM carregado', 'success');
            
            // Verifica autentica√ß√£o
            const isAuthenticated = sessionStorage.getItem('authenticated') === 'true';
            if (isAuthenticated) {
                addDebugLog('J√° autenticado');
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('mainContent').classList.add('show');
            }

            // Login
            document.getElementById('loginBtn').addEventListener('click', () => {
                addDebugLog('Bot√£o de login clicado');
                checkPassword();
            });

            document.getElementById('passwordInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    addDebugLog('Enter pressionado no input');
                    checkPassword();
                }
            });

            // Video DropZone
            const videoDropZone = document.getElementById('videoDropZone');
            const videoInput = document.getElementById('videoInput');

            addDebugLog('Configurando event listeners para v√≠deo...');

            videoDropZone.addEventListener('click', () => {
                addDebugLog('DropZone clicado!');
                videoInput.click();
            });

            videoDropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                addDebugLog('Arquivo sendo arrastado sobre dropzone');
                videoDropZone.style.borderColor = '#10b981';
            });

            videoDropZone.addEventListener('dragleave', () => {
                addDebugLog('Arquivo saiu do dropzone');
                videoDropZone.style.borderColor = '#3a3a3a';
            });

            videoDropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                addDebugLog('Arquivo DROPADO!', 'success');
                videoDropZone.style.borderColor = '#3a3a3a';
                
                const file = e.dataTransfer.files[0];
                addDebugLog(`Arquivo dropado: ${file ? file.name : 'NENHUM'}`, file ? 'success' : 'error');
                
                if (file && file.type.startsWith('video/')) {
                    handleVideoFile(file);
                } else {
                    addDebugLog('Arquivo n√£o √© v√≠deo!', 'error');
                }
            });

            videoInput.addEventListener('change', (e) => {
                addDebugLog('Input file mudou!');
                const file = e.target.files[0];
                addDebugLog(`Arquivo selecionado: ${file ? file.name : 'NENHUM'}`, file ? 'success' : 'error');
                
                if (file) {
                    handleVideoFile(file);
                }
            });

            // Bot√µes
            document.getElementById('videoUploadBtn').addEventListener('click', () => {
                addDebugLog('Bot√£o upload clicado');
                uploadVideo();
            });

            document.getElementById('cancelVideoBtn').addEventListener('click', () => {
                addDebugLog('Bot√£o cancelar clicado');
                cancelVideoUpload();
            });

            addDebugLog('Todos os event listeners configurados!', 'success');
        });

        // Captura erros globais
        window.addEventListener('error', (e) => {
            addDebugLog(`ERRO GLOBAL: ${e.message} em ${e.filename}:${e.lineno}`, 'error');
        });

        addDebugLog('Aguardando DOMContentLoaded...');
    </script>
</body>
</html>
